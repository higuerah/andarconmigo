<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AR Video Collar</title>

    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>

    <!-- AR.js -->
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>

    <style>
        #starter {
            position: fixed;
            inset: 0;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        #startBtn {
            padding: 16px 24px;
            border: none;
            background: #ff0055;
            color: white;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
        }

        #startBtn:hover {
            background: #d40048;
        }
    </style>
</head>

<body>

<div id="starter">
    <button id="startBtn">Toca para iniciar la experiencia ðŸ’–</button>
</div>

<a-scene 
    embedded 
    vr-mode-ui="enabled: false"
    renderer="logarithmicDepthBuffer: true;"
    arjs="sourceType: webcam; debugUIEnabled: false;"
>

    <!-- ASSETS -->
    <a-assets>
        <video id="vid" src="video.mp4" preload="auto" playsinline webkit-playsinline></video>
    </a-assets>

    <!-- MARCADOR -->
    <a-marker 
        type="pattern" 
        url="pattern-marker.patt"
        smooth="true"
        smoothCount="10"
        smoothTolerance="0.01"
        smoothThreshold="5"
    >

        <!-- CONTENEDOR PRINCIPAL (auto escala segÃºn distancia) -->
        <a-entity id="container" scale="1 1 1">

            <!-- MARCO ELEGANTE -->
            <a-plane 
                width="1.4" 
                height="0.9"
                color="#8B0000"
                position="0 0 0"
                material="shader: flat;"
            ></a-plane>

            <!-- VIDEO -->
            <a-video 
                id="videoPlane"
                src="#vid"
                width="1.28" 
                height="0.72"
                position="0 0 0.01"
                material="shader: flat;"
            ></a-video>

            <!-- PARTÃCULAS ALREDEDOR -->
            <a-entity 
                position="0 0 0.05"
                particle-system="
                    preset: dust;
                    particleCount: 2500;
                    size: 0.02;
                    maxAge: 2;
                    opacity: 0.7;
                    color: #ff3366, #ffd1e1;
                    randomize: true;
                "
            ></a-entity>

        </a-entity>

    </a-marker>

    <a-entity camera></a-entity>

</a-scene>

<script>
    const btn = document.getElementById("startBtn");
    const overlay = document.getElementById("starter");
    const video = document.getElementById("vid");

    // Necesario para desbloquear audio en iOS
    btn.addEventListener("click", () => {
        overlay.style.display = "none";
        video.pause(); // aseguramos que no arranque autoforce
    });

    // Detecta marcador
    const marker = document.querySelector("a-marker");

    marker.addEventListener("markerFound", () => {
        video.play();
    });

    marker.addEventListener("markerLost", () => {
        video.pause();
    });
</script>

</body>
</html>