<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Para ti</title>

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>

  <!-- AR.js -->
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

  <style>
    body { margin: 0; background: #000; }

    #starter {
      position: fixed; inset: 0;
      background: #000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      color: #fff;
    }

    #startBtn {
      padding: 12px 18px;
      background: #ff3366;
      border: none;
      border-radius: 10px;
      color: #fff;
      font-weight: bold;
    }

    /* Fade suave del video */
    #videoPlane {
      transition: opacity 0.5s ease-in-out;
      opacity: 0; /* inicia oculto */
    }
  </style>
</head>

<body>

<div id="starter">
  <button id="startBtn">Hay tanto que quiero contarte...</button>
  <p style="margin-top:10px; opacity:.7;">Apunta al collar bebé ❤️</p>
</div>

<a-scene embedded vr-mode-ui="enabled:false" arjs="sourceType: webcam; debugUIEnabled: false;">

  <!-- ASSETS -->
  <a-assets>
    <video id="vid" src="video.mp4" preload="auto" loop playsinline webkit-playsinline crossorigin="anonymous"></video>
  </a-assets>

  <!-- MARKER -->
  <a-marker type="pattern" url="pattern-marker.patt"
            smooth="true" smoothCount="10" smoothTolerance="0.01" smoothThreshold="5">

    <!-- contenedor AR -->
    <a-entity rotation="-90 0 0">

      <!-- VIDEO - sin marco y sin partículas -->
      <a-video
        id="videoPlane"
        src="#vid"
        width="1"
        height="0.56"
        position="0 0 0"
        material="shader: flat;">
      </a-video>

    </a-entity>
  </a-marker>

  <a-entity camera></a-entity>
</a-scene>

<script>
  const startBtn = document.getElementById("startBtn");
  const starter = document.getElementById("starter");
  const video = document.getElementById("vid");
  const marker = document.querySelector("a-marker");
  const videoPlane = document.querySelector("#videoPlane");

  // Activar permisos del video
  startBtn.addEventListener("click", async () => {
    starter.style.display = "none";

    // Hack para desbloquear reproducción en iPhone
    try {
      await video.play();
      video.pause();
    } catch (e) {}
  });

  // Cuando encuentra el marcador
  marker.addEventListener("markerFound", () => {
    video.currentTime = 0;
    video.play();
    videoPlane.setAttribute("opacity", 1);  // Fade in
  });

  // Cuando pierde el marcador
  marker.addEventListener("markerLost", () => {
    video.pause();
    videoPlane.setAttribute("opacity", 0); // Fade out
  });
</script>

</body>
</html>